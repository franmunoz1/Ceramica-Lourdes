---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAllProducts, getProductBySlug } from "../../lib/products.js";

export async function getStaticPaths() {
  const products = await getAllProducts();
  return products.map((p) => ({
    params: { slug: p.slug },
  }));
}

const { slug } = Astro.params;
const product = await getProductBySlug(slug);

if (!product) {
  return new Response(null, { status: 404, statusText: "Not found" });
}

const waMessage = `Hola! Estoy viendo el catÃ¡logo y quisiera consultar por: ${product.name} ðŸ˜Š`;

const imageSrc = (product?.image ?? "")
  .replace(/^\/?public\//, "/")
  .replace(/^uploads\//, "/uploads/");

const finalSrc = imageSrc && !imageSrc.startsWith("/") ? `/${imageSrc}` : imageSrc;

---

<BaseLayout title={product.name}>
  <div class="grid gap-6 md:grid-cols-2">
    <div class="rounded-2xl border bg-white overflow-hidden">
      <div class="aspect-square bg-slate-100">
        <img src={finalSrc} alt={product.name} class="h-full w-full object-cover" />
      </div>
    </div>

    <div class="rounded-2xl border bg-white p-6">
      <p class="text-xs text-slate-500">Producto</p>
      <h1 class="mt-1 text-2xl font-semibold">{product.name}</h1>

      <p class="mt-3 text-xl font-bold">
        ${product.price.toLocaleString("es-AR")}
      </p>

      <p class="mt-4 text-sm text-slate-600 leading-relaxed">
        {product.description}
      </p>

      <div class="mt-6 flex flex-col gap-3 sm:flex-row">
        <a
          href={`https://wa.me/5493513881970?text=${encodeURIComponent(waMessage)}`}
          target="_blank"
          rel="noopener noreferrer"
          class="rounded-xl bg-black px-4 py-3 text-white text-sm text-center hover:opacity-90 transition"
        >
          Consultar por WhatsApp
        </a>

        <a href="/" class="rounded-xl border px-4 py-3 text-sm text-center hover:bg-slate-100 transition">
          Volver
        </a>
      </div>
    </div>
  </div>
</BaseLayout>
